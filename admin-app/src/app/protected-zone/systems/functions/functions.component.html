<div class="animated fadeIn">
    <p-card #cadFunc [style]="{'margin-bottom':'10px'}">
        <p-toolbar styleClass='p-mb-4'>
            <ng-template pTemplate="left">
                <button appPermission appFunction="SYSTEM_FUNCTION" appAction="CREATE" pButton type="button" label="Thêm"
                        icon="fa fa-plus" (click)="showAddModal()" class="p-mr-2"></button>
                <button appPermission appFunction="SYSTEM_FUNCTION" appAction="DELETE" pButton type="button" label="Xóa"
                        icon="fa fa-trash" class="p-button-danger p-mr-2" *ngIf="selectedItems.length > 0" (click)="deleteItems()"></button>
                <button appPermission appFunction="SYSTEM_FUNCTION" appAction="UPDATE" pButton type="button" label="Sửa"
                        icon="fa fa-edit" class="p-button-warning p-mr-2" *ngIf="selectedItems.length== 1"
                        (click)="showEditModal()"></button>
                <p-checkbox label="Hiển thị hành động" [(ngModel)]="showCommandGrid" (click)="togglePanel()" binary="true">
                </p-checkbox>
            </ng-template>
        </p-toolbar>
        <p-treeTable *ngIf="items"
                     [value]="items"
                     selectionMode="multiple"
                     [(selection)]="selectedItems"
                     dataKey="id"
                     [metaKeySelection]="true"
                     (onNodeSelect)="nodeSelect($event)"
                     (onNodeUnselect)="nodeUnSelect($event)">
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 10%;">
                        <p-treeTableHeaderCheckbox></p-treeTableHeaderCheckbox>
                    </th>
                    <th>Tên</th>
                    <th class="pgrid-hidden-xs">Mã</th>
                    <th>Thứ tự</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
                <tr [ttSelectableRow]="rowNode">
                    <td style="width: 10%;">
                        <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
                        <p-treeTableCheckbox [value]="rowNode"></p-treeTableCheckbox>
                    </td>
                    <td>
                        {{rowData.name}}
                    </td>
                    <td class="pgrid-hidden-xs">
                        {{rowData.id}}
                    </td>
                    <td class="pgrid-hidden-sm">
                        {{rowData.sortOrder}}
                    </td>

                </tr>
            </ng-template>
        </p-treeTable>
        <p-blockUI [target]="cadFunc" [blocked]="blockedPanel">
            <p-progressSpinner [style]="{width: '100px', height: '100px', position:'absolute',top:'25%',left:'50%'}"
                               strokeWidth="2" animationDuration=".5s"></p-progressSpinner>
        </p-blockUI>
    </p-card>

    <p-card #cadCommand *ngIf="showCommandGrid">
        <p-toolbar>
            <div class="p-col-12">
                <button pButton type="button" label="Thêm hành động" icon="fa fa-plus" *ngIf="selectedItems.length == 1"
                        (click)="addCommandsToFunction()" class="mr-2"></button>
                <button pButton type="button" label="Xóa hành động" icon="fa fa-trash" class="p-button-danger"
                        *ngIf="selectedCommandItems.length > 0" (click)="removeCommands()"></button>
            </div>
        </p-toolbar>
        <p-table #dt [value]="commands" selectionMode="multiple" [metaKeySelection]="true"
                 [(selection)]="selectionCommandItems" [responsive]="true">
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 3rem">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>
                    <th>Mã hành động
                    </th>
                    <th>Tên hành động
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
                <tr [pSelectableRow]="row">
                    <td style="width: 3rem">
                        <p-tableCheckbox [value]="row"></p-tableCheckbox>
                    </td>
                    <td>{{row.id}}</td>
                    <td>{{row.name}}</td>
                </tr>
            </ng-template>
        </p-table>
        <p-blockUI [target]="cadCommand" [blocked]="blockedPanelAction">
            <p-progressSpinner [style]="{width: '100px', height: '100px', position:'absolute',top:'25%',left:'50%'}"
                               strokeWidth="2" animationDuration=".5s"></p-progressSpinner>
        </p-blockUI>
    </p-card>
</div>
